# Converter (FFmpeg-powered WinForms Studio)

Converter — это современное настольное приложение на .NET 8/Windows Forms, построенное на основе многоуровневой архитектуры с принципами Domain-Driven Design (DDD) и паттерном Model-View-Presenter (MVP). Приложение объединяет пакетное кодирование видео через FFmpeg с богатым интерфейсом: плиточная панель drag&drop, полноценный редактор роликов, умные пресеты, аудиообработка, очередь заданий и система уведомлений.2231

## Ключевые возможности

### Архитектурные особенности
- **Современная многоуровневая архитектура** с четким разделением ответственности
- **MVP паттерн** для разделения UI и бизнес-логики
- **Domain-Driven Design** принципы в организации кода
- **Dependency Injection** для управления зависимостями
- **Event-driven обновления** UI через Observer паттерн

### Импорт и предпросмотр
- **Drag & Drop холст** с миниатюрами и карточками файлов ("перетащи или выбери"), которые показывают длительность, кодек и размер и позволяют удалять кликом по оверлею. 【F:UI/DragDropPanel.cs】
- **Расширенный список файлов** с превью, шкалой прогресса, контекстным меню обновления кадра и индикатором статуса прямо на главной форме. 【F:UI/Controls/FileListItem.cs】
- **Встроенный видео‑редактор** (кадрирование, обрезка, эффекты, правка субтитров, предпросмотр и экспорт). 【F:UI/VideoEditorForm.cs】

### Настройки кодирования
- Поддержка распространённых контейнеров и кодеков, CRF-профилей, масштабирования по пресетам/процентам, шаблонов имени файла, подпапки `Converted`, выбора FFmpeg, потоков и аппаратного ускорения.
- **Аудиоблок** позволяет отключать дорожку либо настраивать кодек/битрейт и применять нормализацию, шумоподавление, эквалайзер и fade‑эффекты через отдельную панель. 【F:UI/AudioProcessingPanel.cs】
- **Сервис пресетов** подгружает десятки профилей (YouTube, Instagram, TikTok, archival и т.д.), группирует их по категориям и позволяет сохранять/загружать пользовательские профили в JSON/XML. 【F:src/Converter.Application/Services/ProfileProvider.cs】

### Очередь и автоматизация
- Отдельная вкладка "Очередь" c контролом управления (автостарт, ограничение параллельности, сортировки по приоритету/размеру/длительности/дате, фильтры по статусу, очищение завершённых). 【F:UI/Controls/QueueControlPanel.cs】
- **Менеджер очереди** обрабатывает несколько файлов параллельно, ведёт прогресс, позволяет поднимать/опускать, приостанавливать, отменять элементы и выставлять приоритеты. 【F:src/Converter.Application/Services/QueueService.cs】
- После батча можно открыть диалог статистики (суммарные размеры, экономию места, скорость) и окно "Поделиться" с готовыми текстами для соцсетей и генератором карточки PNG. 【F:UI/Dialogs/StatisticsDialog.cs】

### Обратная связь и удобство
- **Панель оценок** считает примерное время и итоговый размер файла еще до начала конвертации. 【F:UI/Controls/EstimatePanel.cs】
- Логи с таймстампами, двойной прогресс (общий + текущий), история завершённых конверсий.
- Автоустановка FFmpeg в `%LocalAppData%/Converter/ffmpeg`, если путь не указан.
- **Уведомления**: гибкая настройка всплывающих toast'ов, звуков и напоминаний о прогрессе. 【F:src/Converter.Infrastructure/Notifications/NotificationGateway.cs】
- **Шеринг**: генерация отчёта, копирование готовых текстов и сохранение карточки с результатами. 【F:UI/Dialogs/ShareDialog.cs】

### Темы и UI
- **Менеджер тем** управляет светлыми/тёмными палитрами, анимацией переходов и авто‑переключением по расписанию. 【F:Services/ThemeManager.cs】
- Сплит‑макет: слева плитка и список файлов, справа вкладки "Пресеты", "Видео", "Аудио", "Очередь", снизу — прогресс и лог.

## Требования
- Windows 10/11
- .NET 8.0 SDK (для сборки) / Desktop Runtime (для запуска)
- Первое подключение к интернету для авто‑скачивания FFmpeg

## Сборка и запуск
```bash
dotnet restore
dotnet build
dotnet run --project Converter.csproj
```
Или откройте `Converter.sln` в Visual Studio 2022+ и запустите проект.

## Архитектура

Проект построен на основе современной многоуровневой архитектуры с четким разделением ответственности:

### Domain Layer (`src/Converter.Domain`)
- **Бизнес-модели**: `QueueItem`, `ConversionSettings`, `AudioProcessingOptions`
- **Перечисления**: `ConversionStatus`
- **Не зависит от других слоев** - ядро бизнес-логики

### Application Layer (`src/Converter.Application`)
- **Абстракции**: Интерфейсы для всех сервисов (`IQueueService`, `IConversionOrchestrator`, `IFFmpegExecutor`)
- **Презентеры**: `MainPresenter` - посредник между UI и бизнес-логикой
- **ViewModels**: `QueueItemViewModel`, `MainViewModel` - для привязки данных
- **Сервисы**: `QueueService`, `ConversionOrchestrator`, `ProfileProvider`
- **DTOs**: `QueueItemDto` - для передачи данных между слоями

### Infrastructure Layer (`src/Converter.Infrastructure`)
- **FFmpeg**: `FFmpegExecutor`, `ThumbnailProvider`, `FfmpegBootstrapService`
- **Persistence**: `JsonQueueStore`, `JsonSettingsStore`, `FileSettingsStore`
- **Notifications**: `NotificationGateway`
- **Dependency Injection**: `ServiceCollectionExtensions`

### Presentation Layer
- **`Form1.cs`** - Реализует `IMainView`, выступает как View в MVP
- **`UI/`** - Переиспользуемые контролы и диалоги
- **`Services/`** - Устаревшие сервисы (в процессе миграции)

### Поддерживаемые паттерны
- **MVP (Model-View-Presenter)** - четкое разделение UI и логики
- **Repository Pattern** - для работы с данными
- **Service Layer** - для бизнес-операций
- **Dependency Injection** - для управления зависимостями